(function(a,b){var c=-999,d=/^https?:\/\/(.*)\.(jpg|png|gif|jpeg)(\?.*)?/i,e=e||function(e,f){function g(a,b){for(var c in b)a[c]=b[c];return a}function h(){if(bb.placeholder){var a;for(i=0,len=$.length;len>i;i++)a=$[i],a[z(a)]||(j(a,bb.placeholder),a.onblur=Q,a.onfocus=P)}}function j(a,b){p=Z.createElement("span"),p.innerText=b,p.className="g-placeholder",a.appendChild(p)}function k(){var a=Z.createElement("div"),b="<div class='options'>             <span class='no-overflow'>               <span class='ui-inputs'>                 <button class='bold'>B</button>                 <button class='italic'>i</button>                 <button class='header1'>h1</button>                 <button class='header2'>h2</button>                 <button class='quote'>&rdquo;</button>                 <button class='url useicons'>&#xe001;</button>                 <input class='url-input' type='text' placeholder='Paste or type a link'/>               </span>             </span>           </div>",c=Z.createElement("div"),d=Z.createElement("div");d.className="g-body",Z.body.appendChild(d),c.innerHTML="<div class='pos-abs file-label'>Insert image</div>                                           <input class='file-hidden pos-abs' type='file' id='files' name='files[]' accept='image/*' multiple/>",c.className="image-tooltip hide",a.className="text-menu hide",a.innerHTML=b,0===Z.querySelectorAll(".text-menu").length&&(d.appendChild(a),d.appendChild(c)),W=Z.querySelectorAll(".file-label + input")[0],V=Z.querySelectorAll(".image-tooltip")[0],R=Z.querySelectorAll(".text-menu")[0],S=Z.querySelectorAll(".text-menu .options")[0],T=Z.querySelectorAll(".text-menu .url-input")[0]}function l(){var a,b,c;for(Y.onresize=N,T.onblur=F,T.onkeydown=G,bb.allowImages&&(V.onmousedown=n,W.onchange=o,Z.onmousemove=m),a=0,b=$.length;b>a;a++)c=$[a],c.contentEditable=!0,c.className=c.className+" g-editor",c.onmouseup=function(a){setTimeout(function(){N(a)},1)},c.onkeydown=w,c.onkeyup=function(a){var b=window.getSelection();b.anchorNode&&"ARTICLE"!==b.anchorNode.nodeName&&(x(a),b.isCollapsed&&C(a))},c.onmousedown=N}function m(a){q(a,a.target)}function n(){var a=_.children,b=_.getBoundingClientRect();X=r(a,b)}function o(){var a,b=this.files[0],c=new FileReader;c.onload=function(){return function(b){a=Z.createElement("figure"),a.innerHTML='<img src="'+b.target.result+'"/>',_.insertBefore(a,X.bottomElement)}}(b),c.readAsDataURL(b)}function q(){var a=_.children,b=_.getBoundingClientRect(),d=r(a,b);d?(V.style.left=b.left-90+"px",V.style.top=d.top-17+"px"):(V.style.left=c+"px",V.style.top=c+"px")}function r(a){var b,c,d,e,f,g,h,i,j=[];for(c=0,d=a.length-1;d>c;c++)e=a[c],f=a[c+1]||null,g=e.getBoundingClientRect().bottom-5,h=f.getBoundingClientRect().top,j.push({top:h,bottom:g,topElement:e,bottomElement:f,index:c+1});for(i=event.pageY-Y.scrollY,c=0,d=j.length;d>c;c++)if(b=j[c],i<b.top&&i>b.bottom)return b;return null}function s(a){var b,c,d,e=Z.querySelectorAll(".text-menu button"),f=function(b){a(b)};for(b=0,c=e.length;c>b;b++)d=e[b],f(d)}function t(){s(function(a){a.onmousedown=function(){E(a)}})}function u(){return Y.getSelection().focusNode}function v(){var a,b,c,d=u();s(function(e){a=e.className;for(var f in db)if(b=db[f],c=new RegExp(b),c.test(a)){e.className=L(d,f)?b+" active":b;break}})}function w(a){var b,c=window.getSelection(),d=K(c.anchorNode,"p");return"inline"===bb.mode&&13===a.keyCode?void a.preventDefault():void(13===a.keyCode&&d&&(prevSibling=d.previousSibling,b=prevSibling&&"HR"===prevSibling.nodeName&&!(d.textContent.length||d.getElementsByTagName("img").length),b&&a.preventDefault()))}function x(a){var b,c=window.getSelection();13===a.keyCode&&("DIV"===c.anchorNode.nodeName&&H("p"),b=K(c.anchorNode,"p"),b&&y(b))}function y(a){var b,c,d;for(b=a.previousSibling,c=b;c&&c.nodeType==Node.TEXT_NODE;)c=c.previousSibling;"P"!==b.nodeName||b.textContent.length||b.getElementsByTagName("img").length||"HR"===c.nodeName||(d=Z.createElement("hr"),d.contentEditable=!1,a.parentNode.replaceChild(d,b))}function z(a){var b;return b=a.nodeType===Node.TEXT_NODE?"data":ab?"textContent":"innerText"}function A(a,b,c){var d="ol"===c?"insertOrderedList":"insertUnorderedList",e="ol"===c?3:2;return Z.execCommand(d),a.anchorNode[b]=a.anchorNode[b].substring(e),K(a.anchorNode,c)}function B(a,b){var c=a.anchorNode[b];return a.anchorNode[b]="",Z.execCommand("InsertImage",!1,c),K(a.anchorNode,"img")}function C(){var a,b,c,e,f,g,h=window.getSelection();h.isCollapsed&&h.anchorNode&&"ARTICLE"!==h.anchorNode.nodeName&&(a=z(h.anchorNode),b=h.anchorNode[a],b.match(/^[-*]\s/)&&"LI"!==h.anchorNode.parentNode.nodeName&&(c=A(h,a,"ul")),b.match(/^1\.\s/)&&"LI"!==h.anchorNode.parentNode.nodeName&&(c=A(h,a,"ol")),"rich"===bb.mode&&bb.imagesFromUrls&&b.match(d)&&(c=B(h,a)),e=c&&["ul","ol"].indexOf(c.nodeName.toLocaleLowerCase())>=0&&["p","div"].indexOf(c.parentNode.nodeName.toLocaleLowerCase())>=0,e&&(f=h.anchorNode,g=c.parentNode,g.parentNode.insertBefore(c,g),g.parentNode.removeChild(g),D(h,f)))}function D(a,b){range=Z.createRange(),range.setStart(b,0),range.setEnd(b,0),a.removeAllRanges(),a.addRange(range)}function E(a){var b,c,d=a.className,e=window.getSelection(),f=e.anchorNode;for(var g in db)if(b=db[g],c=new RegExp(b),c.test(d))switch(g){case"b":return void(!f||L(f,"h1")||L(f,"h2")||Z.execCommand(b,!1));case"i":return void Z.execCommand(b,!1);case"h1":case"h2":case"h3":case"blockquote":return void H(g);case"a":return I(),void(S.className="options url-mode")}N()}function F(){var a=T.value;return S.className="options",window.getSelection().addRange(U),Z.execCommand("unlink",!1),""===a?!1:(a.match("^(http://|https://|mailto:)")||(a="http://"+a),Z.execCommand("createLink",!1,a),void(T.value=""))}function G(a){13===a.keyCode&&(a.preventDefault(),a.stopPropagation(),T.blur())}function H(a){L(u(),a)?(Z.execCommand("formatBlock",!1,"p"),Z.execCommand("outdent")):Z.execCommand("formatBlock",!1,a)}function I(){setTimeout(function(){var a=M(u());"undefined"!=typeof a?T.value=a:Z.execCommand("createLink",!1,"/"),U=window.getSelection().getRangeAt(0),T.focus()},150)}function J(a,b,c){if(null!==a)for(;a.parentNode;){if(b(a))return c(a);a=a.parentNode}}function K(a,b){var c=function(a){return a.nodeName.toLowerCase()===b},d=function(a){return a};return J(a,c,d)}function L(a,b){return!!K(a,b)}function M(a){var b=function(a){return"undefined"!=typeof a.href},c=function(a){return a.href};return J(a,b,c)}function N(a){var b,d,e=Y.getSelection(),f=a.target||a.srcElement;return f.isContentEditable&&"rich"===bb.mode?void(e.isCollapsed?(O(c,c),R.className="text-menu hide"):(b=e.getRangeAt(0),d=b.getBoundingClientRect(),v(),O(d.top-5+Y.pageYOffset,(d.left+d.right)/2))):void v()}function O(a,b){bb.rtl&&(b+=200),R.style.top=a+"px",R.style.left=b+"px",bb.animate&&(R.className=a===c?"text-menu hide":"text-menu active")}function P(a){for(var b,c=a.target,d=c.getElementsByClassName("g-placeholder"),e=0;e<d.length;e++)c.removeChild(d[e]),b=!0;if(b){var f=Z.createRange();f.selectNodeContents(this);var g=window.getSelection();g.removeAllRanges(),g.addRange(f)}}function Q(a){var b=a.target,d=b[z(b)];d.trim()||j(b,bb.placeholder),-1===S.className.search("url-mode")&&(O(c,c),R.className="text-menu hide")}var R,S,T,U,V,W,X,Y=a,Z=b,$=Z.querySelectorAll(".g-body article"),_=$[0],ab=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,bb={animate:!0,placeholder:null,mode:"rich",rtl:!1,imagesFromUrls:!1},cb=function(a,b){a&&($=a),bb=g(bb,b),k(),h(),l(),t()},db={b:"bold",i:"italic",h1:"header1",h2:"header2",a:"url",blockquote:"quote"};cb(e,f)};"undefined"!=typeof module&&module.exports&&(module.exports=e),"undefined"==typeof ender&&(this.Grande=e),"function"==typeof define&&define.amd&&define("Grande",[],function(){return e})}).call(this,window,document);