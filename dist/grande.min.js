G={};G.Class=function(){};G.Class.extend=function(e){var t=function(){if(this.initialize){this.initialize.apply(this,arguments)}if(this._initHooks.length){this.callInitHooks()}};var n=t.__super__=this.prototype;var r=G.Util.create(n);r.constructor=t;t.prototype=r;for(var i in this){if(this.hasOwnProperty(i)&&i!=="prototype"){t[i]=this[i]}}if(e.statics){G.extend(t,e.statics);delete e.statics}if(e.includes){G.Util.extend.apply(null,[r].concat(e.includes));delete e.includes}if(r.options){e.options=G.Util.extend(G.Util.create(r.options),e.options)}G.extend(r,e);r._initHooks=[];r.callInitHooks=function(){if(this._initHooksCalled){return}if(n.callInitHooks){n.callInitHooks.call(this)}this._initHooksCalled=true;for(var e=0,t=r._initHooks.length;e<t;e++){r._initHooks[e].call(this)}};return t};G.Util={extend:function(e){var t=Array.prototype.slice.call(arguments,1),n,r,i,s;for(r=0,i=t.length;r<i;r++){s=t[r];for(n in s){e[n]=s[n]}}return e},create:Object.create||function(){function e(){}return function(t){e.prototype=t;return new e}}(),bind:function(e,t){var n=Array.prototype.slice;if(e.bind){return e.bind.apply(e,n.call(arguments,1))}var r=n.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(n.call(arguments)):arguments)}},setOptions:function(e,t){if(!e.hasOwnProperty("options")){e.options=e.options?G.Util.create(e.options):{}}for(var n in t){e.options[n]=t[n]}return e.options},isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},castArray:function(e){if(this.isArray(e))return e;return[e]}};G.extend=G.Util.extend;G.setOptions=G.Util.setOptions;G.Evented=G.Class.extend({on:function(e,t,n){if(typeof e==="object"){for(var r in e){this._on(r,e[r],t)}}else{e=G.Util.splitWords(e);for(var i=0,s=e.length;i<s;i++){this._on(e[i],t,n)}}return this},off:function(e,t,n){if(!e){delete this._events}else if(typeof e==="object"){for(var r in e){this._off(r,e[r],t)}}else{e=G.Util.splitWords(e);for(var i=0,s=e.length;i<s;i++){this._off(e[i],t,n)}}return this},_on:function(e,t,n){var r=this._events=this._events||{},i=n&&n!==this&&G.stamp(n);if(i){var s=e+"_idx",o=e+"_len",u=r[s]=r[s]||{},a=G.stamp(t)+"_"+i;if(!u[a]){u[a]={fn:t,ctx:n};r[o]=(r[o]||0)+1}}else{r[e]=r[e]||[];r[e].push({fn:t})}},_off:function(e,t,n){var r=this._events,i=e+"_idx",s=e+"_len";if(!r){return}if(!t){delete r[e];delete r[i];delete r[s];return}var o=n&&n!==this&&G.stamp(n),u,a,f,l,c;if(o){c=G.stamp(t)+"_"+o;u=r[i];if(u&&u[c]){l=u[c];delete u[c];r[s]--}}else{u=r[e];if(u){for(a=0,f=u.length;a<f;a++){if(u[a].fn===t){l=u[a];u.splice(a,1);break}}}}if(l){l.fn=G.Util.falseFn}},fire:function(e,t,n){if(!this.listens(e,n)){return this}var r=G.Util.extend({},t,{type:e,target:this}),i=this._events;if(i){var s=i[e+"_idx"],o,u,a,f;if(i[e]){a=i[e].slice();for(o=0,u=a.length;o<u;o++){a[o].fn.call(this,r)}}for(f in s){s[f].fn.call(s[f].ctx,r)}}if(n){this._propagateEvent(r)}return this},listens:function(e,t){var n=this._events;if(n&&(n[e]||n[e+"_len"])){return true}if(t){for(var r in this._eventParents){if(this._eventParents[r].listens(e,t)){return true}}}return false},once:function(e,t,n){if(typeof e==="object"){for(var r in e){this.once(r,e[r],t)}return this}var i=G.bind(function(){this.off(e,t,n).off(e,i,n)},this);return this.on(e,t,n).on(e,i,n)},addEventParent:function(e){this._eventParents=this._eventParents||{};this._eventParents[G.stamp(e)]=e;return this},removeEventParent:function(e){if(this._eventParents){delete this._eventParents[G.stamp(e)]}return this},_propagateEvent:function(e){for(var t in this._eventParents){this._eventParents[t].fire(e.type,G.extend({layer:e.target},e),true)}}});var proto=G.Evented.prototype;proto.addEventListener=proto.on;proto.removeEventListener=proto.clearAllEventListeners=proto.off;proto.addOneTimeEventListener=proto.once;proto.fireEvent=proto.fire;proto.hasEventListeners=proto.listens;G.Mixin={Events:proto};G.Rande=G.Class.extend({EDGE:-999,editNode:document.querySelectorAll(".g-body article")[0],isFirefox:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,options:{animate:true,imageUpload:true,events:{change:function(e){console.log("change options.event!",e)}}},tagClassMap:{b:"bold",i:"italic",h1:"header1",h2:"header2",a:"url",blockquote:"quote"},events:{change:function(e){console.log("change event!",e)}},initialize:function(e,t){G.r=this;G.setOptions(this,e);this.initToolbarLayout();this.initPlugins();if(t)this.bind(t);return this},bind:function(e){this.editableNodes=G.Util.castArray(e)||document.querySelectorAll(".g-body article");this.addHooks()},unbind:function(){this.removeHooks();this.removePlugins()},addToolbarButton:function(e){this.buttonsContainer.insertBefore(e,this.buttonsContainer.lastChild)},initPlugins:function(e,t){this.plugins=this.options.plugins;for(p in this.plugins){var n=this.plugins[p];n.plugin(this)}},select:function(){this.triggerTextSelection()},addToOptions:function(e){this.optionsNode.appendChild(e)},addHooks:function(){this._setHooks(true)},removeHooks:function(){this._setHooks(false)},_setHooks:function(e){e=e?"addEventListener":"removeEventListener";document[e]("mousedown",this.triggerTextSelection,false);document[e]("keydown",this.preprocessKeyDown,false);document[e]("keyup",this.handleKeyUp,false);window[e]("resize",this.triggerTextSelection,false);this.urlInput[e]("blur",this.triggerUrlBlur,false);this.urlInput[e]("keydown",this.triggerUrlSet,false);if(this.options.allowImages){this.imageTooltip[e]("mousedown",this.triggerImageUpload,false);this.imageInput[e]("change",this.uploadImage,false);document[e]("mousemove",this.triggerOverlayStyling,false)}for(var t=0,n=this.editableNodes.length;t<n;t++){var r=this.editableNodes[t];r.contentEditable=true;r[e]("mousedown",this.triggerTextSelection,false);r[e]("mouseup",this.triggerTextSelection,false);r[e]("keyup",this.triggerTextSelection,false)}var i=this;this.iterateTextMenuButtons(function(t){t[e]("mousedown",function(e){i.triggerTextStyling(t)},false)})},initToolbarLayout:function(){this.toolbarContainer=document.createElement("div");this.toolbarContainer.className="g-body";document.body.appendChild(this.toolbarContainer);this.imageTooltipTemplate=document.createElement("div");this.imageTooltipTemplate.innerHTML="<div class='pos-abs file-label'>Insert image</div> 																				<input class='file-hidden pos-abs' type='file' id='files' name='files[]' accept='image/*' multiple/>";this.imageTooltipTemplate.className="image-tooltip hide";this.toolbarTemplate="<div class='options'> 			<span class='no-overflow'> 				<span class='ui-inputs'> 					<button class='bold'>B</button> 					<button class='italic'>i</button> 					<button class='header1'>h1</button> 					<button class='header2'>h2</button> 					<button class='quote'>&rdquo;</button> 					<button class='url useicons'>&#xe001;</button> 					<input class='url-input' type='text' placeholder='Paste or type a link'/> 				</span> 			</span> 		</div>";var e=document.createElement("div");e.className="text-menu hide";e.innerHTML=this.toolbarTemplate;if(document.querySelectorAll(".text-menu").length===0){this.toolbarContainer.appendChild(e);this.toolbarContainer.appendChild(this.imageTooltipTemplate)}this.imageInput=document.querySelectorAll(".file-label + input")[0];this.imageTooltip=document.querySelectorAll(".image-tooltip")[0];this.textMenu=document.querySelectorAll(".text-menu")[0];this.optionsNode=document.querySelectorAll(".text-menu .options")[0];this.urlInput=document.querySelectorAll(".text-menu .url-input")[0];this.uiInputs=document.querySelectorAll(".ui-inputs")[0];this.buttons=this.uiInputs.childNodes;this.buttonsContainer=this.uiInputs},handleKeyUp:function(e){var t=G.r;var n=window.getSelection();if(n.anchorNode&&n.anchorNode.nodeName!=="ARTICLE"){t.triggerNodeAnalysis(e);if(n.isCollapsed){t.triggerTextParse(e)}}},triggerOverlayStyling:function(e){this.toggleImageTooltip(e,e.target)},triggerImageUpload:function(e){var t=editNode.children;var n=editNode.getBoundingClientRect();this.imageBound=this.getHorizontalBounds(t,n,e)},triggerNodeAnalysis:function(e){var t=window.getSelection(),n,r;if(e.keyCode===13){if(t.anchorNode.nodeName==="DIV"){this.toggleFormatBlock("p")}r=this.getParentWithTag(t.anchorNode,"p");if(r){this.insertHorizontalRule(r)}}},triggerTextParse:function(e){var t=window.getSelection(),n,r,i,s,o,u,a;if(!t.isCollapsed||!t.anchorNode||t.anchorNode.nodeName==="ARTICLE"){return}n=this.getTextProp(t.anchorNode);r=t.anchorNode[n];if(r.match(/^[-*]\s/)&&t.anchorNode.parentNode.nodeName!=="LI"){i=insertListOnSelection(t,n,"ul")}if(r.match(/^1\.\s/)&&t.anchorNode.parentNode.nodeName!=="LI"){i=insertListOnSelection(t,n,"ol")}s=i&&["ul","ol"].indexOf(i.nodeName.toLocaleLowerCase())>=0&&["p","div"].indexOf(i.parentNode.nodeName.toLocaleLowerCase())>=0;if(s){o=t.anchorNode;u=i.parentNode;u.parentNode.insertBefore(i,u);u.parentNode.removeChild(u);this.moveCursorToBeginningOfSelection(t,o)}},triggerTextStyling:function(e){var t=e.className,n=window.getSelection(),r=n.anchorNode,i,s;for(var o in this.tagClassMap){i=this.tagClassMap[o];s=new RegExp(i);if(s.test(t)){switch(o){case"b":return document.execCommand(i,false);case"i":return document.execCommand(i,false);case"h1":case"h2":case"h3":case"blockquote":return this.toggleFormatBlock(o);case"a":this.toggleUrlInput();this.optionsNode.className="options url-mode";return}}}},triggerUrlBlur:function(e){var t=G.r;var n=t.urlInput.value;t.optionsNode.className="options";if(n==="")return t.removeLink();if(!n.match("^(http://|https://|mailto:)"))n="http://"+n;t.createLink(n);t.urlInput.value=""},triggerUrlSet:function(e){var t=G.r;if(e.keyCode===13){e.preventDefault();e.stopPropagation();t.urlInput.blur()}},triggerTextSelection:function(e,t){var n=G.r;var r=window.getSelection(),i=e.target||e.srcElement;var s=n.buttons;for(var o=0;o<s.length;o++){if(s[o]==i)return n.reloadMenuState()}if(i==n.optionsNode)return n.reloadMenuState();if(!i.isContentEditable){n.hideToolbar();n.textMenu.className="text-menu hide";n.reloadMenuState();return n.options.events.change()}if(r.isCollapsed){n.hideToolbar();n.textMenu.className="text-menu hide";n.reloadMenuState();return}n.showToolbar(r);n.reloadMenuState();return n.options.events.change()},showToolbar:function(e){var t=e.getRangeAt(0);var n=t.getBoundingClientRect();this.setTextMenuPosition(n.top-45+window.pageYOffset,(n.left+n.right)/2);this.toolbarOpen=true},hideToolbar:function(){if(!this.toolbarOpen)return;this.toolbarOpen=false;this.setTextMenuPosition(this.EDGE,this.EDGE);this._fireHiddenToolbar()},_fireHiddenToolbar:function(){var e=this.plugins;for(p in e){var t=e[p];t.onToolbarHide()}},createLink:function(e){this.removeLink();document.execCommand("createLink",false,e)},removeLink:function(){var e=this.previouslySelectedText;if(!e)return;window.getSelection().addRange(e);document.execCommand("unlink",false)},getHorizontalBounds:function(e,t,n){var r=[],i,s,o,u,a,f,l,c;for(s=0,o=e.length-1;s<o;s++){u=e[s];a=e[s+1]||null;f=u.getBoundingClientRect().bottom-5;l=a.getBoundingClientRect().top;r.push({top:l,bottom:f,topElement:u,bottomElement:a,index:s+1})}c=n.pageY-root.scrollY;for(s=0,o=r.length;s<o;s++){i=r[s];if(c<i.top&&c>i.bottom){return i}}return null},getTextProp:function(e){var t;if(e.nodeType===Node.TEXT_NODE){t="data"}else if(this.isFirefox){t="textContent"}else{t="innerText"}return t},getFocusNode:function(){return window.getSelection().focusNode},getParent:function(e,t,n){if(e===null){return}while(e.parentNode){if(t(e)){return n(e)}e=e.parentNode}},getParentWithTag:function(e,t){var n=function(e){return e.nodeName.toLowerCase()===t};var r=function(e){return e};return this.getParent(e,n,r)},getParentHref:function(e){var t=function(e){return typeof e.href!=="undefined"};var n=function(e){return e.href};return this.getParent(e,t,n)},hasParentWithTag:function(e,t){return!!this.getParentWithTag(e,t)},toggleFormatBlock:function(e){if(this.hasParentWithTag(this.getFocusNode(),e)){document.execCommand("formatBlock",false,"p");document.execCommand("outdent")}else{document.execCommand("formatBlock",false,e)}},toggleUrlInput:function(){var e=this;setTimeout(function(){var t=e.getParentHref(e.getFocusNode());if(typeof t!=="undefined"){e.urlInput.value=t}e.previouslySelectedText=window.getSelection().getRangeAt(0);e.urlInput.focus()},150)},toggleImageTooltip:function(e,t){var n=editNode.children;var r=editNode.getBoundingClientRect();var i=getHorizontalBounds(n,r,e);if(i){this.imageTooltip.style.left=r.left-90+"px";this.imageTooltip.style.top=i.top-17+"px"}else{this.imageTooltip.style.left=EDGE+"px";this.imageTooltip.style.top=EDGE+"px"}},setTextMenuPosition:function(e,t){this.textMenu.style.top=e+"px";this.textMenu.style.left=t+"px";if(this.options.animate){if(e===this.EDGE){this.textMenu.className="text-menu hide"}else{this.textMenu.className="text-menu active"}}},insertHorizontalRule:function(e){var t,n,r;t=e.previousSibling;n=t;while(n){if(n.nodeType!=Node.TEXT_NODE){break}n=n.previousSibling}if(!t||!n)return;if(t.nodeName==="P"&&!t.textContent.length&&n.nodeName!=="HR"){r=document.createElement("hr");r.contentEditable=false;e.parentNode.replaceChild(r,t)}},insertListOnSelection:function(e,t,n){var r=n==="ol"?"insertOrderedList":"insertUnorderedList",i=n==="ol"?3:2;document.execCommand(this[r]);e.anchorNode[t]=e.anchorNode[t].substring(i);return this.getParentWithTag(e.anchorNode,n)},insertImage:function(e){var t=document.createElement("img");t.src=e;t.style.width="200px";t.style.height="auto";var n=window.getSelection().getRangeAt(0);n.collapse(true);n.insertNode(t)},reloadMenuState:function(){var e,t=this.getFocusNode(),n,r,i=this;this.iterateTextMenuButtons(function(s){e=s.className;for(var o in i.tagClassMap){n=i.tagClassMap[o];r=new RegExp(n);if(r.test(e)){if(i.hasParentWithTag(t,o)){s.className=n+" active"}else{s.className=n}break}}})},preprocessKeyDown:function(e){var t=G.r;var n=window.getSelection(),r=t.getParentWithTag(n.anchorNode,"p"),i,s;if(e.keyCode===13&&r){prevSibling=r.previousSibling;s=prevSibling&&prevSibling.nodeName==="HR"&&!r.textContent.length;if(s)e.preventDefault()}},iterateTextMenuButtons:function(e){var t=document.querySelectorAll(".text-menu button"),n,r,i,s=function(t){e(t)};for(n=0,r=t.length;n<r;n++){i=t[n];s(i)}},moveCursorToBeginningOfSelection:function(e,t){range=document.createRange();range.setStart(t,0);range.setEnd(t,0);e.removeAllRanges();e.addRange(range)},uploadImage:function(e){var t=this.files[0],n=new FileReader,r;n.onload=function(e){return function(e){r=document.createElement("figure");r.innerHTML='<img src="'+e.target.result+'"/>';editNode.insertBefore(r,imageBound.bottomElement)}}(t);n.readAsDataURL(t)}});G.rande=function(e,t){return new G.Rande(t,e)}