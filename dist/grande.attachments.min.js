G.Attachments=G.Class.extend({name:"Attachments",initialize:function(e,t){G.setOptions(this,t);this.source=e},_initialize:function(){this.initLayout();this.addHooks();this.initialized=true},plugin:function(e){this.grande=e;this._initialize()},initLayout:function(){this.button=this.createButton();this.grande.addToolbarButton(this.button)},createButton:function(){var e=document.createElement("button");e.className="attachment";e.innerHTML="F";return e},addHooks:function(){var e=this;this.button.addEventListener("mousedown",function(t){e.toggleButton(t,e)},false)},removeHooks:function(){var e=this;this.button.removeEventListener("mousedown",function(t){e.toggleButton(t,e)},false)},toggleButton:function(e,t){var n=e.target;Wu.DomEvent.stop(e);if(n.active){t.closePopup();n.active=false;n.className="attachment"}else{t.openPopup();n.active=true;n.className="attachment active"}},closePopup:function(){this.destroyPopup()},openPopup:function(){this.createPopup()},createPopup:function(){this.project=app.activeProject;var e=this.source;var t=this._popup=Wu.DomUtil.create("div","grande-sources-container");var n=Wu.DomUtil.create("div","grande-sources-topwrap",t);e.forEach(function(e){this._createSource(e,t)},this);this.grande.addToOptions(t)},_createSource:function(e,t){var n=e.title;var r=Wu.DomUtil.create("div","grande-sources-source",t);var i=Wu.DomUtil.create("div","grande-sources-source-icon",r);var s=Wu.DomUtil.create("div","grande-sources-source-title",r,n);Wu.DomUtil.addClass(i,e.type);if(e.thumbnail){var o=Wu.DomUtil.create("img","grande-sources-source-thumb",r);o.src=e.thumbnail}Wu.DomEvent.on(r,"mousedown",function(){if(this.options.embedImage){this.embedImage(e.url)}else{this.selectSource(e)}},this)},destroyPopup:function(){if(!this._popup)return;this._remove(this._popup);this._popup=null},embedImage:function(e){this.grande.insertImage(e)},selectSource:function(e){var t=e.url;this.grande.createLink(t)},_remove:function(e){var t=e.parentNode;if(t){t.removeChild(e)}},destroy:function(){this.removeHooks()},onToolbarHide:function(){this.closePopup()}})